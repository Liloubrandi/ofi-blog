"use strict";(self.webpackChunkofi_blog_versioned=self.webpackChunkofi_blog_versioned||[]).push([[4729],{84729:(t,e,i)=>{i.r(e),i.d(e,{default:()=>R});var s=i(67294);const o="quillEditor_NxYB",n="quillAnswer_J46I",r="monospace_usc_",l="disableToolbar_bRdP",a="saveIndicator_PFXL";var h=i(86010),d=i(71217),c=i(74322),u=i(16164);const p={fileTypes:{regex:/^image\/(gif|jpe?g|a?png|svg|webp|bmp|heic|heif)/i,accept:"image/*,image/heic,image/heif"},downscale:{maxWidth:1024,maxHeight:1024,imageType:"image/jpeg",keepImageTypes:void 0,ignoreImageTypes:void 0,imageQuality:.5}};async function m(t){const{maxWidth:e,maxHeight:i,keepImageTypes:s,ignoreImageTypes:o,imageQuality:n}=p.downscale;let{imageType:r}=p.downscale;const l=t.split(";")[0].split(":")[1],a=new Image;a.src=t,await new Promise((t=>{a.onload=()=>{t()}}));const[h,d]=function(t,e,i,s){if(i&&s&&t<=i&&e<=s)return[t,e];if(i&&t>i){const o=i,n=Math.floor(e/t*o);if(s&&n>s){const i=s;return[Math.floor(t/e*i),i]}return[o,n]}if(s&&e>s){const i=s;return[Math.floor(t/e*i),i]}return[e,t]}(a.width,a.height,e,i),c=document.createElement("canvas");c.width=h,c.height=d;const u=c.getContext("2d");if("image/jpeg"===r&&(u.fillStyle="#FFFFFF",u.fillRect(0,0,a.width,a.height)),null!=o&&o.includes(l))return t;null!=s&&s.includes(l)&&(r=l),u.drawImage(a,0,0,h,d);return c.toDataURL(r,n)}async function g(t){const e=new FileReader;let s;return s="image/heic"===t.type.toLowerCase()||"image/heif"===t.type.toLowerCase()?i.e(1616).then(i.t.bind(i,1616,23)).then((e=>e.default({blob:t,toType:"image/jpeg",quality:.9}))):Promise.resolve(t),s?s.then((t=>{const i=new Promise(((t,i)=>{e.addEventListener("load",(()=>{var s;const o=null==(s=e.result)?void 0:s.toString();o?t(o):i("could not convert file to base64")}),!1)}));return e.readAsDataURL(t),i})):Promise.reject("could not convert file to base64")}const f=async t=>{if(t.preventDefault(),document.caretRangeFromPoint){const e=document.getSelection(),i=document.caretRangeFromPoint(t.clientX,t.clientY);e&&i&&e.setBaseAndExtent(i.startContainer,i.startOffset,i.startContainer,i.startOffset)}const e=await async function(t){var e;return null==t||null==(e=t.dataTransfer)?void 0:e.files}(t),i=Array.from(e||[]).filter((t=>!!t.type.match(p.fileTypes.regex))),s=null==i?void 0:i[0];if(s){return await g(s)}const o=await async function(t){var e;const i=null==(e=t.dataTransfer)?void 0:e.getData("URL");if(i){return await(await fetch(i)).blob()}}(t);if(o){return await g(o)}};const y=async t=>{var e,i;const s=Array.from((null==t||null==(e=t.clipboardData)?void 0:e.items)||[]).filter((t=>!!t.type.match(p.fileTypes.regex)));if(!s.length)return;if(!s.filter((t=>"text/html"!==t.type)).length)return void console.log("handlePaste also detected html");t.preventDefault();const o=null==(i=s.pop())?void 0:i.getAsFile();if(!o)return;return await g(o)};var v=i(91189),b=i(66913),x=i.n(b);const w={modules:["DisplaySize","Toolbar","Resize"],overlayStyles:{position:"absolute",boxSizing:"border-box",border:"1px dashed #444"},handleStyles:{position:"absolute",height:"12px",width:"12px",backgroundColor:"white",border:"1px solid #777",boxSizing:"border-box",opacity:"0.80"},displayStyles:{position:"absolute",font:"12px/1.0 Arial, Helvetica, sans-serif",padding:"4px 8px",textAlign:"center",backgroundColor:"white",color:"#333",border:"1px solid #777",boxSizing:"border-box",opacity:"0.80",cursor:"default"},toolbarStyles:{position:"absolute",top:"-12px",right:"0",left:"0",height:"0",minWidth:"100px",font:"12px/1.0 Arial, Helvetica, sans-serif",textAlign:"center",color:"#333",boxSizing:"border-box",cursor:"default"},toolbarButtonStyles:{display:"inline-block",width:"24px",height:"24px",background:"white",border:"1px solid #999",verticalAlign:"middle"},toolbarButtonSvgStyles:{fill:"#444",stroke:"#444",strokeWidth:"2"}};class E{constructor(t){(0,v.Z)(this,"options",void 0),(0,v.Z)(this,"img",void 0),(0,v.Z)(this,"overlay",void 0),(0,v.Z)(this,"requestUpdate",void 0),(0,v.Z)(this,"onCreate",(t=>{})),(0,v.Z)(this,"onDestroy",(()=>{})),(0,v.Z)(this,"onUpdate",(()=>{})),this.overlay=t.overlay,this.img=t.img,this.options=t.options,this.requestUpdate=t.onUpdate}}let S={},Z={},k={},C={};class A extends E{constructor(){super(...arguments),(0,v.Z)(this,"toolbar",void 0),(0,v.Z)(this,"alignments",void 0),(0,v.Z)(this,"onCreate",(()=>{window&&window.Quill&&(S=window.Quill.import("parchment"),Z=new S.Attributor.Style("float","float"),k=new S.Attributor.Style("margin","margin"),C=new S.Attributor.Style("display","display")),this.toolbar=document.createElement("div"),Object.assign(this.toolbar.style,this.options.toolbarStyles),this.overlay.appendChild(this.toolbar),this._defineAlignments(),this._addToolbarButtons()})),(0,v.Z)(this,"onDestroy",(()=>{})),(0,v.Z)(this,"onUpdate",(()=>{})),(0,v.Z)(this,"_defineAlignments",(()=>{this.alignments=[{icon:"format-align-left",apply:()=>{C.add(this.img,"inline"),Z.add(this.img,"left"),k.add(this.img,"0 1em 1em 0")},isApplied:()=>"left"==Z.value(this.img)},{icon:"format-align-center",apply:()=>{C.add(this.img,"block"),Z.remove(this.img),k.add(this.img,"auto")},isApplied:()=>"auto"==k.value(this.img)},{icon:"format-align-right",apply:()=>{C.add(this.img,"inline"),Z.add(this.img,"right"),k.add(this.img,"0 0 1em 1em")},isApplied:()=>"right"==Z.value(this.img)}]})),(0,v.Z)(this,"_addToolbarButtons",(()=>{const t=[];this.alignments.forEach(((e,i)=>{const s=document.createElement("span");t.push(s),s.innerHTML='<i class="mdi mdi-'+e.icon+'" style="font-size: 20px"/>',s.addEventListener("click",(()=>{t.forEach((t=>t.style.filter="")),e.isApplied()?(Z.remove(this.img),k.remove(this.img),C.remove(this.img)):(this._selectButton(s),e.apply()),this.requestUpdate()})),Object.assign(s.style,this.options.toolbarButtonStyles),i>0&&(s.style.borderLeftWidth="0"),e.isApplied()&&this._selectButton(s),this.toolbar.appendChild(s)}))})),(0,v.Z)(this,"_selectButton",(t=>{t.style.filter="invert(20%)"}))}}class B extends E{constructor(){super(...arguments),(0,v.Z)(this,"boxes",void 0),(0,v.Z)(this,"dragBox",void 0),(0,v.Z)(this,"dragStartX",void 0),(0,v.Z)(this,"preDragWidth",void 0),(0,v.Z)(this,"onCreate",(()=>{this.boxes=[],this.addBox("nwse-resize"),this.addBox("nesw-resize"),this.addBox("nwse-resize"),this.addBox("nesw-resize"),this.positionBoxes()})),(0,v.Z)(this,"onDestroy",(()=>{this.setCursor("")})),(0,v.Z)(this,"positionBoxes",(()=>{const t=-parseFloat(this.options.handleStyles.width)/2+"px",e=-parseFloat(this.options.handleStyles.height)/2+"px";[{left:t,top:e},{right:t,top:e},{right:t,bottom:e},{left:t,bottom:e}].forEach(((t,e)=>{Object.assign(this.boxes[e].style,t)}))})),(0,v.Z)(this,"addBox",(t=>{const e=document.createElement("div");Object.assign(e.style,this.options.handleStyles),e.style.cursor=t,e.style.width=this.options.handleStyles.width+"px",e.style.height=this.options.handleStyles.height+"px",e.addEventListener("mousedown",this.handleMousedown,!1),this.overlay.appendChild(e),this.boxes.push(e)})),(0,v.Z)(this,"handleMousedown",(t=>{this.dragBox=t.target,this.dragStartX=t.clientX,this.preDragWidth=this.img.width||this.img.naturalWidth,this.setCursor(this.dragBox.style.cursor),document.addEventListener("mousemove",this.handleDrag,!1),document.addEventListener("mouseup",this.handleMouseup,!1)})),(0,v.Z)(this,"handleMouseup",(()=>{this.setCursor(""),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleMouseup)})),(0,v.Z)(this,"handleDrag",(t=>{if(!this.img)return;const e=t.clientX-this.dragStartX;this.dragBox===this.boxes[0]||this.dragBox===this.boxes[3]?(this.img.width=Math.round(this.preDragWidth-e),this.img.style.width=Math.round(this.preDragWidth-e)+"px"):(this.img.width=Math.round(this.preDragWidth+e),this.img.style.width=Math.round(this.preDragWidth+e)+"px"),this.requestUpdate()})),(0,v.Z)(this,"setCursor",(t=>{[document.body,this.img].forEach((e=>{e.style.cursor=t}))}))}}class L extends E{constructor(){super(...arguments),(0,v.Z)(this,"display",void 0),(0,v.Z)(this,"onCreate",(()=>{this.display=document.createElement("div"),Object.assign(this.display.style,this.options.displayStyles),this.overlay.appendChild(this.display)})),(0,v.Z)(this,"onDestroy",(()=>{})),(0,v.Z)(this,"onUpdate",(()=>{if(!this.display||!this.img)return;const t=this.getCurrentSize();if(this.display.innerHTML=t.join(" &times; "),t[0]>120&&t[1]>30)Object.assign(this.display.style,{right:"4px",bottom:"4px",left:"auto"});else if("right"==this.img.style.float){const t=this.display.getBoundingClientRect();Object.assign(this.display.style,{right:"auto",bottom:"-"+(t.height+4)+"px",left:"-"+(t.width+4)+"px"})}else{const t=this.display.getBoundingClientRect();Object.assign(this.display.style,{right:"-"+(t.width+4)+"px",bottom:"-"+(t.height+4)+"px",left:"auto"})}})),(0,v.Z)(this,"getCurrentSize",(()=>[this.img.width,Math.round(this.img.width/this.img.naturalWidth*this.img.naturalHeight)]))}}class M{constructor(t,e){void 0===e&&(e={}),(0,v.Z)(this,"quill",void 0),(0,v.Z)(this,"options",void 0),(0,v.Z)(this,"modules",void 0),(0,v.Z)(this,"img",void 0),(0,v.Z)(this,"overlay",void 0),(0,v.Z)(this,"initializeModules",(()=>{this.removeModules(),this.modules=[new A(this)],matchMedia("(pointer:fine)").matches&&(this.modules.push(new L(this)),this.modules.push(new B(this))),this.modules.forEach((t=>{t.onCreate()})),this.onUpdate()})),(0,v.Z)(this,"onUpdate",(()=>{this.repositionElements(),this.modules.forEach((t=>{t.onUpdate()}))})),(0,v.Z)(this,"removeModules",(()=>{this.modules.forEach((t=>{t.onDestroy()})),this.modules=[]})),(0,v.Z)(this,"handleClick",(t=>{if(t.target&&t.target.tagName&&"IMG"===t.target.tagName.toUpperCase()){if(this.img===t.target)return;this.img&&this.hide(),this.show(t.target)}else this.img&&this.hide()})),(0,v.Z)(this,"show",(t=>{this.img=t,this.showOverlay(),this.initializeModules()})),(0,v.Z)(this,"showOverlay",(()=>{this.overlay&&this.hideOverlay(),this.quill.setSelection(null),this.setUserSelect("none"),document.addEventListener("keyup",this.checkImage,!0),this.quill.root.addEventListener("input",this.checkImage,!0),this.overlay=document.createElement("div"),Object.assign(this.overlay.style,this.options.overlayStyles),this.quill.root.parentNode.appendChild(this.overlay),this.repositionElements()})),(0,v.Z)(this,"hideOverlay",(()=>{this.overlay&&(this.quill.root.parentNode.removeChild(this.overlay),this.overlay=void 0,document.removeEventListener("keyup",this.checkImage),this.quill.root.removeEventListener("input",this.checkImage),this.setUserSelect(""))})),(0,v.Z)(this,"repositionElements",(()=>{if(!this.overlay||!this.img)return;const t=this.quill.root.parentNode,e=this.img.getBoundingClientRect(),i=t.getBoundingClientRect();Object.assign(this.overlay.style,{left:e.left-i.left-1+t.scrollLeft+"px",top:e.top-i.top+t.scrollTop+"px",width:e.width+"px",height:e.height+"px"})})),(0,v.Z)(this,"hide",(()=>{this.hideOverlay(),this.removeModules(),this.img=void 0})),(0,v.Z)(this,"setUserSelect",(t=>{["userSelect","mozUserSelect","webkitUserSelect","msUserSelect"].forEach((e=>{this.quill.root.style[e]=t,document.documentElement.style[e]=t}))})),(0,v.Z)(this,"checkImage",(t=>{this.img&&(46!=t.keyCode&&8!=t.keyCode||window.Quill.find(this.img).deleteAt(0),this.hide())})),this.quill=t,this.options=x()({},e,w),document.execCommand("enableObjectResizing",!1,"false"),this.quill.root.addEventListener("click",this.handleClick,!1),this.quill.root.parentNode.style.position=this.quill.root.parentNode.style.position||"relative",this.modules=[]}}const T=[["bold","italic","underline"],[{header:[1,2,3,!1]}],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],["image"]],q=t=>{const e=[];if(t.bold||t.italic||t.underline){const i=[];t.bold&&i.push("bold"),t.italic&&i.push("italic"),t.underline&&i.push("underline"),e.push(i)}if(t.h1||t.h2||t.h3){const i=[];t.h1&&i.push(1),t.h2&&i.push(2),t.h3&&i.push(3),i.push(!1),e.push(i)}if(t.color||t.background){const i=[];t.color&&i.push({color:[]}),t.background&&i.push({background:[]}),e.push(i)}if(t.ul||t.ol){const i=[];t.ol&&i.push({list:"ordered"}),t.ul&&i.push({list:"bullet"}),e.push(i)}if(t.formula||t.image){const i=[];t.formula&&i.push("formula"),t.image&&i.push("image"),e.push(i)}return t.code&&e.push(["code-block"]),e},U=["bold","italic","underline","strike","align","list","indent","size","width","header","link","image","video","color","background","clean","code-block","indent","blockquote","script","code","style"];var D=i(92814),z=i(51436),O=i(68949);const R=(0,d.Pi)((t=>{const e=s.useRef(!1),{model:i}=t,[d,v]=s.useState(!1),[b,x]=s.useState(!1),[w,E]=s.useState(!1),S={toolbar:t.toolbar?q(t.toolbar):[...T,...q(t.toolbarAdd||{})],imageResize:{handleStyles:{borderRadius:"50%"}}},Z=t.theme||"snow",k=t.placeholder||"\u270d\ufe0f Antwort...",{quill:C,quillRef:A,Quill:B}=(0,u.p)({theme:Z,modules:S,formats:U,placeholder:k});s.useEffect((()=>(e.current=!0,()=>{e.current=!1})),[]),s.useEffect((()=>{let t;const e=(0,O.U5)((()=>i.saveService.state),((e,i)=>{"save"===i&&"done"===e&&(E(!0),t=setTimeout((()=>{E(!1),t=void 0}),1500))}));return()=>{t&&clearTimeout(t),e()}}),[i]),s.useEffect((()=>{C&&C.on("text-change",((t,e,s)=>{i.setText(C.root.innerHTML)}))}),[C]),s.useEffect((()=>{const e=t=>{t.preventDefault()};if(C){C.clipboard.dangerouslyPasteHTML(i.text||""),C.blur(),t.readonly&&C.disable(),C.getModule("toolbar").addHandler("image",R),C.root.addEventListener("drop",j),C.root.addEventListener("paste",_),C.getModule("toolbar").container.addEventListener("mousedown",e);const s=navigator.userAgent.includes("Mac");C.keyboard.addBinding({key:"s",metaKey:s,ctrlKey:!s},(()=>i.saveService.saveNow()))}return()=>{C&&C.getModule("toolbar").container.removeEventListener("mousedown",e)}}),[C]);const L=async t=>{if(!t)return x(!1);m(t).then((t=>{(t=>{if(!e.current||!C)return;const i=C.getSelection(!0);C.insertEmbed(i.index,"image",t),i.index++,C.setSelection(i,"api"),C.insertText(i.index,"\n"),i.index++,C.setSelection(i,"api")})(t)})).catch((()=>{console.log("Could not insert image")})).finally((()=>{e.current&&x(!1)}))},R=()=>{const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",p.fileTypes.accept),t.click(),t.onchange=()=>{if(!t.files||t.files.length<1)return;const e=t.files[0];x(!0),g(e).then(L)}},j=t=>{f(t).then(L)},_=t=>{y(t).then(L)};if(B&&!C){var F=B.import("formats/image");const t=["alt","height","width","style"];class e extends F{static formats(e){return t.reduce((function(t,i){return e.hasAttribute(i)&&(t[i]=e.getAttribute(i)),t}),{})}format(e,i){t.indexOf(e)>-1?i?this.domNode.setAttribute(e,i):this.domNode.removeAttribute(e):super.format(e,i)}}B.register(e,!0),window.Quill=B,B.register("modules/imageResize",M)}return s.createElement("div",{className:(0,h.default)(o),onFocus:()=>!d&&v(!0)},s.createElement("div",{className:(0,h.default)("quill-editor-container",n,t.monospace&&r,d?void 0:l)},s.createElement("div",{ref:A}),b&&s.createElement(c.Z,{caption:"Bild Einf\xfcgen...",overlay:!0}),s.createElement("span",{style:{minWidth:"1em"},className:a},"save"===i.saveService.state&&s.createElement(D.G,{icon:z.UO1,style:{color:"#3578e5"},spin:!0}),w&&s.createElement(D.G,{icon:z.f8k,style:{color:"var(--ifm-color-success)"}}))))}))}}]);